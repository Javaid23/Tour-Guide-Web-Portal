import{j as e}from"./index-Cu-NLfXN.js";import{u as s,r as t}from"./router-Dd4lY5Dn.js";import{u as a,c as r,r as l,p as n}from"./api-CQ5h52SX.js";import{y as o,U as i,x as c,k as d,e as m,o as x,S as u,t as g,b as h,P as b,c as p,z as y,K as j,N as f}from"./icons-D1SVnQiw.js";import"./vendor-Z2Iecplj.js";const N=({open:s,onClose:t,children:a,className:r})=>s?e.jsx("div",{className:r||"fixed z-50 inset-0 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:t}),e.jsx("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full max-h-[90vh] overflow-y-auto",children:a})]})}):null,w=()=>{const w=s(),[v,P]=t.useState({name:"",email:"",contact:"",role:"tourist"}),[k,S]=t.useState([]),[C,A]=t.useState([]),[D,E]=t.useState([]),[L,T]=t.useState([]),[F,R]=t.useState("personal"),[I,B]=t.useState(!0),[$,M]=t.useState(""),[U,z]=t.useState(!1),[G,O]=t.useState(!1),[q,H]=t.useState({currentPassword:"",newPassword:"",confirmPassword:""});t.useEffect(()=>{W();const e=()=>{console.log("New booking created, refreshing profile data..."),Y()},s=()=>{console.log("New review created, refreshing reviews..."),_()};return window.addEventListener("bookingCreated",e),window.addEventListener("reviewCreated",s),()=>{window.removeEventListener("bookingCreated",e),window.removeEventListener("reviewCreated",s)}},[]);const W=async()=>{try{const e=localStorage.getItem("user");if(e){if("admin"===JSON.parse(e).role)return void w("/admin")}await Y()}catch(e){console.error("Error checking user role:",e),B(!1)}},Y=async()=>{try{B(!0);const s=await a.getProfile(),t=s.data||s;if("admin"===t.role)return void w("/admin");P({...t,contact:t.phone||t.contact||"",role:t.role||"tourist"}),console.log("👤 User profile loaded:",t);try{console.log("🔍 Starting to fetch bookings..."),console.log("Auth token exists:",!!localStorage.getItem("token"));const e=await r.getUserBookings();console.log("📋 Profile: Raw bookings response:",e),console.log("📋 Profile: Response structure:",Object.keys(e||{}));const s=e.data?.bookings||e.bookings||e.data||[];console.log("📋 Profile: Processed bookings data:",s),console.log("📋 Profile: Bookings array length:",s.length),S(s)}catch(e){console.error("❌ Failed to fetch bookings:",e),console.error("❌ Error details:",e.response?.data),console.error("❌ Error status:",e.response?.status),S([])}try{const e=await l.getUserReviews();A(e.data||[])}catch(e){console.error("Failed to fetch reviews:",e),A([])}try{const e=await n.getPaymentHistory();E(e.data||[])}catch(e){console.error("Failed to fetch payments:",e),E([])}T([{id:"ANN001",title:"New Safety Guidelines",message:"All guides must follow updated COVID-19 safety protocols during tours.",type:"guideline",date:"2025-08-01",read:!1},{id:"ANN002",title:"Summer Special Discounts",message:"Enjoy 20% off on all mountain tours this summer season!",type:"promotion",date:"2025-07-15",read:!1}])}catch(e){M("Failed to load profile data")}finally{B(!1)}},_=async()=>{try{console.log("Fetching user reviews...");const e=await l.getUserReviews();A(e.data||[]),console.log("Reviews refreshed successfully")}catch(e){console.error("Failed to refresh reviews:",e)}};if(I)return e.jsx("div",{className:"text-center py-20",children:"Loading..."});if("admin"===v.role)return e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center max-w-md",children:[e.jsx(o,{className:"w-16 h-16 mx-auto mb-4 text-blue-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Admin Account Detected"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You have admin privileges. Please use the Admin Panel to manage your account and the platform."}),e.jsx("button",{onClick:()=>w("/admin"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Admin Panel"})]})});const J=[{id:"personal",name:"Personal Info",icon:c},{id:"bookings",name:"My Bookings",icon:d},{id:"reviews",name:"My Reviews",icon:m},{id:"payments",name:"Payment History",icon:x},{id:"security",name:"Security",icon:u},{id:"notifications",name:"Notifications",icon:g}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 py-6 px-4",style:{overflowX:"hidden"},children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:v.name||"Welcome"}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"guide"===v.role?"Tour Guide":"admin"===v.role?"Administrator":"Tourist"," Account"]}),e.jsx("p",{className:"text-sm text-gray-500",children:v.email})]})})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 overflow-x-auto p-4 hide-scrollbar",style:{scrollbarWidth:"none"},children:J.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>R(s.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap "+(F===s.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-blue-600"),children:[e.jsx(t,{className:"w-4 h-4"}),s.name]},s.id)})})})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[$&&e.jsx("div",{className:"mb-6 p-4 rounded-lg "+($.includes("success")||$.includes("updated")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:$}),"personal"===F&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(c,{className:"text-blue-500"}),"Personal Information"]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),M("");try{const e={name:v.name,contact:v.contact,phone:v.contact};await a.updateProfile(e),M("Profile updated successfully!")}catch(s){M(s.message)}},className:"space-y-6 max-w-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-800",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"name",value:v.name||"",onChange:e=>P({...v,name:e.target.value}),className:"w-full border-2 border-gray-200 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all",placeholder:"Enter your full name"}),e.jsx(c,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-800",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"email",value:v.email||"",disabled:!0,className:"w-full border-2 border-gray-200 px-4 py-3 rounded-lg bg-gray-100 text-gray-500"}),e.jsx(h,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Email cannot be changed for security reasons"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-800",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"contact",value:v.contact||"",onChange:e=>P({...v,contact:e.target.value}),className:"w-full border-2 border-gray-200 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all",placeholder:"Enter your phone number"}),e.jsx(b,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-800",children:"Account Role"}),e.jsx("div",{className:"p-3 rounded-lg border "+("admin"===v.role?"bg-red-50 border-red-200":"guide"===v.role?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"),children:e.jsx("span",{className:"font-medium "+("admin"===v.role?"text-red-700":"guide"===v.role?"text-green-700":"text-blue-700"),children:"guide"===v.role?"Tour Guide":"admin"===v.role?"Administrator":"Tourist"})})]}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all",children:"Save Changes"})]})]}),"bookings"===F&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(d,{className:"text-blue-500"}),"My Bookings (",k.length,")"]}),0===k.length?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(d,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No bookings found"})]}):e.jsx("div",{className:"space-y-4",children:k.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.tour?.name||s.destination?.name||`Booking #${t+1}`}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),(()=>{const e=s.tour?.location||s.destination?.location;return"object"==typeof e&&e?`${e.city||""}, ${e.state||""}, ${e.country||""}`.replace(/^,\s*|,\s*$/g,"").replace(/,\s*,/g,","):e||s.customerInfo?.contactPerson||"Location TBA"})()]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",s.startDate?new Date(s.startDate).toLocaleDateString():"TBA"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Payment:"}),e.jsx("span",{className:"ml-1 "+("paid"===s.paymentStatus?"text-green-600":"text-red-600"),children:s.paymentStatus||"pending"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Amount:"})," $",s.totalPrice||s.amount||"0"]})]})]},s._id||t))})]}),"reviews"===F&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(m,{className:"text-blue-500"}),"My Reviews"]}),0===C.length?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(m,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No reviews submitted yet"})]}):e.jsx("div",{className:"space-y-4",children:C.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.tour?.name||"Tour Review"}),e.jsxs("p",{className:"text-gray-600",children:["Guide: ",s.guide?.name||"Unknown"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((t,a)=>e.jsx(m,{className:"w-4 h-4 "+(a<s.rating?"text-yellow-400 fill-current":"text-gray-300")},a))})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:s.comment}),e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-500",children:e.jsxs("span",{children:["Submitted on ",new Date(s.createdAt).toLocaleDateString()]})})]},s._id))})]}),"payments"===F&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(x,{className:"text-blue-500"}),"Payment History"]}),0===D.length?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(x,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No payment history"})]}):e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.tourName}),e.jsxs("p",{className:"text-gray-600",children:["Transaction ID: ",s.transactionId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-lg",children:["$",s.amount," ",s.currency]}),e.jsx("span",{className:"px-2 py-1 rounded text-sm "+("completed"===s.status?"bg-green-100 text-green-700":"failed"===s.status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:s.status})]})]}),e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-600",children:e.jsxs("span",{children:["Paid on ",new Date(s.date).toLocaleDateString()]})})]},s.id))})]}),"security"===F&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(u,{className:"text-blue-500"}),"Security Settings"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Password"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Change your account password"}),e.jsx("button",{onClick:()=>z(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Change Password"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Add an extra layer of security to your account"}),e.jsx("button",{className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Enable 2FA (Coming Soon)"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Active Sessions"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Log out of all devices"}),e.jsxs("button",{className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Log Out All Sessions"]})]})]})]}),"notifications"===F&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(g,{className:"text-blue-500"}),"Notifications"]}),0===L.length?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(g,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No notifications"})]}):e.jsx("div",{className:"space-y-4",children:L.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 "+(s.read?"bg-gray-50":"bg-blue-50 border-blue-200"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.date).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-700",children:s.message})]},s.id))})]})]}),e.jsxs("div",{className:"mt-6 bg-red-50 border border-red-200 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-red-800 mb-2 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),"Danger Zone"]}),e.jsx("p",{className:"text-red-700 mb-4",children:"Once you delete your account, there is no going back. Please be certain."}),e.jsxs("button",{onClick:()=>O(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Delete My Account"]})]})]}),e.jsx(N,{open:U,onClose:()=>z(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),q.newPassword===q.confirmPassword)try{await a.changePassword(q),z(!1),H({currentPassword:"",newPassword:"",confirmPassword:""}),M("Password changed successfully!")}catch(s){M(s.message)}else M("Passwords do not match")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Current Password"}),e.jsx("input",{type:"password",value:q.currentPassword,onChange:e=>H({...q,currentPassword:e.target.value}),className:"w-full border border-gray-300 px-3 py-2 rounded-lg focus:ring-2 focus:ring-blue-400",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"New Password"}),e.jsx("input",{type:"password",value:q.newPassword,onChange:e=>H({...q,newPassword:e.target.value}),className:"w-full border border-gray-300 px-3 py-2 rounded-lg focus:ring-2 focus:ring-blue-400",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:q.confirmPassword,onChange:e=>H({...q,confirmPassword:e.target.value}),className:"w-full border border-gray-300 px-3 py-2 rounded-lg focus:ring-2 focus:ring-blue-400",required:!0})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Change Password"}),e.jsx("button",{type:"button",onClick:()=>z(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancel"})]})]})]})}),e.jsx(N,{open:G,onClose:()=>O(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-red-800",children:"Delete Account"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently removed."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{await a.deleteAccount(),M("Account deletion requested successfully")}catch(e){M(e.message)}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Yes, Delete My Account"}),e.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancel"})]})]})})]})};export{w as default};
